# 1. Context & Goal
- **Objective**: Implement `helios preview` command in the CLI to allow users to preview their production builds locally.
- **Trigger**: Vision gap - "Prototype Fast, Scale Later". Users can currently build (`helios build`) but lack a convenient way to verify the output before deployment.
- **Impact**: Completes the local development workflow (Studio -> Build -> Preview) and improves developer confidence.

# 2. File Inventory
- **Create**: `packages/cli/src/commands/preview.ts`
- **Modify**: `packages/cli/src/index.ts`
- **Read-Only**: `packages/cli/src/commands/build.ts`

# 3. Implementation Spec
- **Architecture**: Utilization of `vite.preview` API to serve the static files generated by `helios build`.
- **Public API Changes**: New CLI command `helios preview [dir]`.
- **Options**:
  - `[dir]`: Project root directory (default: current working directory).
  - `-o, --out-dir <dir>`: Output directory to serve (default: `dist`).
  - `-p, --port <number>`: Port to listen on (default: `4173`).
- **Pseudo-Code**:
  - `packages/cli/src/commands/preview.ts`:
    ```typescript
    import { Command } from 'commander';
    import { preview } from 'vite';
    import chalk from 'chalk';
    import path from 'path';
    import fs from 'fs';

    export function registerPreviewCommand(program: Command) {
      program
        .command('preview [dir]')
        .description('Preview the production build locally')
        .option('-o, --out-dir <dir>', 'Output directory', 'dist')
        .option('-p, --port <number>', 'Port to listen on', '4173')
        .action(async (dir = '.', options) => {
          const rootDir = path.resolve(process.cwd(), dir);
          const outDir = path.resolve(rootDir, options.outDir);

          if (!fs.existsSync(outDir)) {
             console.error(chalk.red(`Error: Build directory not found at ${outDir}`));
             console.error(chalk.yellow(`Run 'helios build' first.`));
             process.exit(1);
          }

          try {
             const server = await preview({
               root: rootDir,
               build: { outDir: options.outDir },
               preview: { port: parseInt(options.port, 10) }
             });
             server.printUrls();
          } catch (e) {
             console.error(chalk.red('Failed to start preview server:'), e);
             process.exit(1);
          }
        });
    }
    ```
  - `packages/cli/src/index.ts`:
    - Import `registerPreviewCommand` from `./commands/preview.js`.
    - Call `registerPreviewCommand(program)` before `program.parse(process.argv)`.

# 4. Test Plan
- **Verification**:
  1.  Navigate to a sample project (e.g., `examples/project-one`).
  2.  Run `npm run build` or `npx helios build` to generate `dist`.
  3.  Run `npx helios preview`.
  4.  Verify console output shows "Local: http://localhost:4173/".
  5.  (Manual) Open URL to confirm player loads.
  6.  Run `npm test -w packages/cli` to ensure no regressions in existing CLI tests.
- **Success Criteria**: Command executes without error, starts server on specified port, serves the build artifact, and existing tests pass.
- **Edge Cases**:
  - `dist` directory missing (should show friendly error).
  - Port already in use.
