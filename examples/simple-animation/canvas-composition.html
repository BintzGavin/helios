<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Canvas Composition</title>
    <style>
      body {
        margin: 0;
        overflow: hidden;
        background-color: #eee;
      }
      canvas {
        display: block;
        width: 100%;
        height: 100%;
      }
    </style>
  </head>
  <body>
    <canvas id="canvas" width="960" height="540"></canvas>

    <script type="module">
      import { Helios } from "../../packages/core/dist/index.js";

      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");

      // Initialize Helios
      const helios = new Helios({
        duration: 5,
        fps: 30
      });

      // Expose for debugging/Player
      window.helios = helios;

      // Function to render the current frame
      function render(currentFrame, duration, fps) {
        // Clear canvas
        ctx.fillStyle = "#eee";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        const time = currentFrame / fps;
        const totalDuration = duration;

        // Calculate animation progress (0 to 1)
        const progress = Math.min(1, Math.max(0, time / totalDuration));

        // Calculate box properties based on animation progress
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        const boxSize = 150;

        // Animation: fade in, scale up, then move to the left
        const opacity = Math.min(progress * 2, 1);
        const scale = 0.5 + progress * 0.5;
        const moveX = progress * (canvas.width - boxSize);

        // Draw the animated box
        ctx.save();
        ctx.globalAlpha = opacity;
        ctx.translate(centerX - moveX, centerY);
        ctx.scale(scale, scale);

        ctx.fillStyle = "#007bff";
        ctx.fillRect(-boxSize / 2, -boxSize / 2, boxSize, boxSize);

        ctx.restore();
      }

      // Subscribe to state changes
      helios.subscribe((state) => {
        render(state.currentFrame, state.duration, state.fps);
      });

      // Initial render
      render(0, 5, 30);

      // Bind to document timeline for external control
      helios.bindToDocumentTimeline();
    </script>
  </body>
</html>
