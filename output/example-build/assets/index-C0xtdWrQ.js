(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function i(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(e){if(e.ep)return;e.ep=!0;const n=i(e);fetch(e.href,n)}})();class o{state;subscribers=new Set;animationFrameId=null;syncWithDocumentTimeline=!1;autoSyncAnimations=!1;animationScope=typeof document<"u"?document:{};constructor(t){this.state={duration:t.duration,fps:t.fps,currentFrame:0,isPlaying:!1},this.autoSyncAnimations=t.autoSyncAnimations||!1,t.animationScope&&(this.animationScope=t.animationScope)}setState(t){this.state={...this.state,...t},this.notifySubscribers()}getState(){return this.state}subscribe(t){return this.subscribers.add(t),t(this.state),()=>this.unsubscribe(t)}unsubscribe(t){this.subscribers.delete(t)}notifySubscribers(){for(const t of this.subscribers)t(this.state)}play(){this.state.isPlaying||(this.setState({isPlaying:!0}),this.animationFrameId=requestAnimationFrame(this.tick))}pause(){this.state.isPlaying&&(this.setState({isPlaying:!1}),this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null))}seek(t){const i=Math.max(0,Math.min(t,this.state.duration*this.state.fps));this.setState({currentFrame:i}),this.autoSyncAnimations&&this.syncDomAnimations(i/this.state.fps*1e3)}syncDomAnimations(t){if(typeof document>"u")return;let i=[];typeof Document<"u"&&this.animationScope instanceof Document?typeof this.animationScope.getAnimations=="function"&&(i=this.animationScope.getAnimations()):typeof this.animationScope.getAnimations=="function"&&(i=this.animationScope.getAnimations({subtree:!0})),i.forEach(e=>{e.currentTime=t,e.playState!=="paused"&&e.pause()})}bindToDocumentTimeline(){if(typeof document>"u"||!document.timeline){console.warn("document.timeline is not available.");return}this.syncWithDocumentTimeline=!0;const t=()=>{if(!this.syncWithDocumentTimeline)return;const i=document.timeline.currentTime;if(i!==null&&typeof i=="number"){const s=Math.round(i/1e3*this.state.fps);s!==this.state.currentFrame&&this.setState({currentFrame:s})}requestAnimationFrame(t)};requestAnimationFrame(t)}unbindFromDocumentTimeline(){this.syncWithDocumentTimeline=!1}tick=()=>{if(!this.state.isPlaying)return;if(this.syncWithDocumentTimeline){this.animationFrameId=requestAnimationFrame(this.tick);return}const t=this.state.duration*this.state.fps,i=this.state.currentFrame+1;if(i>=t){this.setState({currentFrame:t-1}),this.pause();return}this.setState({currentFrame:i}),this.autoSyncAnimations&&this.syncDomAnimations(i/this.state.fps*1e3),this.animationFrameId=requestAnimationFrame(this.tick)}}export{o as H};
